---
const {pricing , id} = Astro.props;
---

<style>
.picker__choose {
    width: 100%;
    margin: 50px 0 0;
    padding: 0 12px;
    text-align: center;
    display: inline-block;
}

.picker__choose__item {
    border-radius: 5px;
    border-top: 12px solid #dce7f0;
    background: #f4faff;
    text-align: center;
    width: 100%;
    margin: 30px 0 75px 0;
    display: inline-block;
    vertical-align: top;
}

.picker__choose__item:last-child {
    margin-bottom: 20px;
}

.picker__choose__item img {
    max-width: 50px;
    width: 100%;
}

.picker__choose__item .bottle {
    line-height: 32px;
    font-size: 27px;
    font-weight: 600;
    color: #fff;
    background-image: -webkit-gradient(linear, left top, right top, from(#5893AE), to(#60B0BF));
    background-image: -webkit-linear-gradient(left, #5893AE, #60B0BF);
    background-image: -o-linear-gradient(left, #5893AE, #60B0BF);
    background-image: linear-gradient(to right, #5893AE, #60B0BF);
    font-family: 'Lato', sans-serif;
    border: 3px solid #0f2a3d;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    text-align: center;
    margin: -75px auto 10px;
    padding-top: 32.5px;
    position: relative;
}

.picker__choose__item .price {
    font-size: 36px;
    line-height: 43px;
    font-weight: 500;
    font-family: 'Lato', sans-serif;
    color: rgb(12, 66, 109);
    margin: 20px 0;
    float: left;
    width: 100%;
}

/* .picker__choose__item .price span {
    font-size: 24px;
    line-height: 29px;
    font-weight: 400;
    color: rgb(51, 51, 51);
} */

.picker__choose__item .save {
    font-family: 'Lato', sans-serif;
    font-size: 22px;
    line-height: 26px;
    font-weight: 400;
    color: rgb(12, 66, 109);
    margin-bottom: 30px;
    line-height: 15px;
}    

@media (min-width: 768px) {
    .picker__choose {
        margin-top: 20px;
        padding: 0;
    }

    .picker__choose__item {
        width: 30%;
        margin: 20px 6px 15px 6px;
        border-top: 6px solid #dce7f0;
    }

    .picker__choose__item .bottle {
        width: 100px;
        height: 100px;
        font-size: 18px;
        line-height: 22px;
        margin: -50px auto 10px;
        padding-top: 25px;
    }

    .picker__choose__item .price {
        font-size: 30px;
        line-height: 36px;
        font-weight: 500;
        margin-top: 0;
    }

    .picker__choose__item .save {
        font-size: 18px;
        line-height: 22px;
        font-weight: 400;
        margin-bottom: 20px;
    }    
}

sub {bottom: -0.1em;}
</style>

<style is:global>
.picker .add-to-cart {
    background-color: #195D7A;
    overflow: auto;
    padding: 20px;
    min-height: 135px;
}
/*.edge {
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
}*/

.picker .add-to-cart .button {
    font-family: 'PT Sans', sans-serif;
    max-width: 243px;
    width: 100%;
    color: #fff !important;
    padding: 16.5px 70.5px !important;
    background-color: rgb(0, 203, 53);
    font-size: 21px;
    font-weight: 400;
    line-height: 25px;
    border-radius: 30px;
    background: #00cb35;
    text-transform: capitalize;
}

.picker .add-to-cart .shipping {
    font-family: 'PT Sans', sans-serif;
    font-size: 22px;
    font-weight: 300;
    line-height: 26px;
    margin-top: 35px;
}

.picker .add-to-cart .nudge {
    font-family: 'PT Sans', sans-serif;
    font-weight: 700;
    display: block;
}

.picker .add-to-cart p {
    color: #fff;
    font-weight: 300;
}

@media (min-width: 768px) {
    .picker .add-to-cart {
        padding: 15px 0 0 0;
    }

    .picker .add-to-cart .button {
        font-size: 16px;
        font-weight: 400;
        line-height: 19px;
        padding: 10px 42px !important;
    }

    .picker .add-to-cart .shipping {
        font-size: 18px;
        line-height: 22px;
        margin-top: 25px;
    }
}    
</style>

<div class="picker__choose">
    <div class="picker__choose__item one">
        <div class="bottle" id={id}>1<br> Bottle</div>
        <h1 class="price">$<span class="price-per-bottle">{pricing.one_bottle.price}</span>/<sub>ea</sub></h1>
        <p class="save">You Save <span class="save-value">-</span>%</p>
        <div class="add-to-cart edge">
            <p><a class="button" href={pricing.one_bottle.url} data-toggle="modal" data-target={pricing.one_bottle.url}>Add 1 To Cart</a></p>
            <p class="shipping">${pricing.one_bottle.price} <br>+ <span class="shipping-cost">-</span> Shipping</p>
        </div>
    </div>
    <div class="picker__choose__item six">
        <div class="middle bottle">6<br> Bottles</div>
        <h1 class="price">$<span class="price-per-bottle">-</span>/<sub>ea</sub></h1>
        <p class="save">You Save <span class="save-value">-</span>%</p>
        <div class="add-to-cart">
            <p><a class="button" href={pricing.six_bottles.url}>Add 6 To Cart</a></p>
            <p class="shipping"><span class="nudge">${pricing.six_bottles.price}<br> + <span class="shipping-cost">-</span> Shipping</span></p>
            <p></p>
        </div>
        <p class="banner--alt">Best Value</p>
    </div>
    <div class="picker__choose__item three">
        <div class="bottle">3<br> Bottles</div>
        <h1 class="price">$<span class="price-per-bottle">-</span>/<sub>ea</sub></h1>
        <p class="save">You Save <span class="save-value">-</span>%</p>
        <div class="add-to-cart edge">
            <p><a class="button" href={pricing.three_bottles.url} data-toggle="modal" data-target={pricing.three_bottles.url}>Add 3 To Cart</a></p>
            <p class="shipping">${pricing.three_bottles.price}<br> + <span class="shipping-cost">-</span> Shipping</p>
            <p></p>
        </div>
    </div>
</div>

<script is:inline define:vars={{ pricing }}>
    window.pricing = pricing
</script>
<script>


document.addEventListener("DOMContentLoaded", function() {

    function pricePerBottle(bottleCount, offerPrice, decimals) {
        return (offerPrice / bottleCount).toFixed(decimals);
    }

    function addShippingPrice(value) {
        return value === 0.00 ? 'Free US' : `$${value.toFixed(2)}`;
    }

    function savingsCalculator(object, originalPrice) {
        let currentPrice = object.price;
        let shippingPrice = object.shipping;
        let bottleCount = object.count;
        let totalPrice = currentPrice + shippingPrice;

        let savings = 100 - 100 * (totalPrice / (originalPrice * bottleCount));
        return savings.toFixed(0);
    }

    function updatePricing(selector, bottleData, originalPrice, decimals) {
        var ppb = document.querySelectorAll(selector + ' .price-per-bottle')
        for(var i = ppb.length - 1; i >= 0; --i)
        {
            ppb[i].textContent = pricePerBottle(bottleData.count, bottleData.price, decimals);
        }
        var save = document.querySelectorAll(selector + ' .save-value')
        for(var i = save.length - 1; i >= 0; --i)
        {
            save[i].textContent = savingsCalculator(bottleData, originalPrice);
        }
        var shipping = document.querySelectorAll(selector + ' .shipping-cost')
        for(var i = shipping.length - 1; i >= 0; --i)
        {
            shipping[i].textContent = addShippingPrice(bottleData.shipping);
        }
    }

    // @ts-ignore
    updatePricing('.six', pricing.six_bottles, pricing.original_price, 0);
    // @ts-ignore
    updatePricing('.three', pricing.three_bottles, pricing.original_price, 0);
    // @ts-ignore
    updatePricing('.one', pricing.one_bottle, pricing.original_price, 2);
});



</script>